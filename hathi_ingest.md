# Packaging for HathiTrust Ingestion
## Introduction
The scripts in this Github repository create packages for ingesting digitized books into HathiTrust. [View the full guidelines for submitting digital content to HathiTrust here.](https://www.hathitrust.org/submission-package-requirements-digitized-content-submitted-to-hathitrust)

Using this code, Temple has ingested over 300 science fiction books into HathiTrust. [Read more about the project here.](https://lcdssgeo.com/omeka-s/s/scifi/page/digitizing-science-fiction)

This file documents the process of running the script to prepare digital object ingest packages for each title, including how to retrieve the files to be ingested, download necessary scripts, and set up and run the code to run in the terminal. 

### 1. Connect to server where files are stored
The SF books from this project are stored in folders on a library server: smb://lib-dss-nas/Novel Database

The folders contain image files (TIFF) of each page of each book. During the ingestion packaging process, these files will be duplicated, OCR will be generated by Google Tesseract, and metadata will be generated corresponding to HathiTrust guidelines. 

**To connect to a server on a Mac,** go to Finder → Connect to Server (⌘K), browse or type name of server where files are stored and click “Connect.” Select which volumes you want to mount on the server (whichever contains the files to be ingested). 

**To connect to a server on a PC,** open File Explorer → This PC → Computer → Map Network Drives and type name of Drive and Folder, then click “Finish.”

### 2. Download ingestion script from Github
Download all files from this repo (https://github.com/TempleDSS/SciFiCorpusOCR) as a ZIP folder. You will only need the hathi_ingest.py and tesseract.sh files for this process; the others are sample data and output. Extract and save the needed files on your local machine (ex. on the Desktop).

### 3. Open a new terminal window
The ingestion script will be run in the terminal. [Here's an introduction to working in the terminal.](https://www.freecodecamp.org/news/command-line-for-beginners/#terminal)

**To open a terminal window on Mac,** Go to Launchpad → Terminal or hit Command + Space Bar.

**To open a terminal window on a PC,** open the Start menu and type command, then select Command Prompt or PowerShell and a window will open. You can also use the shortcut Windows Key + X.

### 4. Install/update Python 3 (if needed)
The ingestion script (hathi_ingest.py) is a Python script and requires Python 3 to run. In an open terminal window, type python --version and hit enter. This will return the current version of Python on your machine. If you do not have Python 3  on your machine, [install before running the script.](https://www.python.org/downloads/)

### 5. Prepare code to run in terminal
Edit the code below so it will locate the ingestion script (hathi_ingest.py) and files to be ingested. 

`python PATH_TO_SCRIPT/hathi_ingest.py PATH_TO_FILES`

Here’s the code used for the SF ingestion: 
`python Desktop/hathi_ingest.py /Volumes/Novel\ Database/Digitized\ Books/Sci-Fi\ Round\ 3`

**How the Code Works:**

* `python` → calls python to run the selected script
* `Desktop/hathi_ingest.py` → points to location of script (saved on Desktop)
* `/Volumes/Novel\ Database/Digitized\ Books/Sci-Fi\ Round\ 3` → Points to path of files to be ingested (folders on a server)

**Finding & copying file paths on a Mac:** In Finder, navigate to the folder where script/files are stored. Hold down Control and click on the folder name/icon. A menu of options should appear. While this menu is open, hold down the Option key. An option will appear to “Copy [Folder Name] as File Path].” Click here and paste into the code. 

**Finding and copying file paths on a PC:** In File Explorer, navigate to folder where script/files are scored. Click on Home ribbon in top of window, then click Copy Path and paste into code. 

**Additional Considerations**
* If the file path name is on a server, include `/Volumes` at start of path. To check that files are mounted on the server, navigate to location using `cd \Volumes` and list all folders and files using `ls -a`. 

* If the file path name includes spaces, you will need to insert “\ “ each time the space occurs before running path in the terminal. 
(ex. `Digitized  Books/Sci-Fi Round 3 → Digitized\ Books/Sci-Fi\ Round\ 3`)  

### 6. Prepare ingestion code (hathi_ingest.py)

Open the ingestion code file in a text editor and make the following changes so it can locate the files to be ingested.

Line 30: top_level_dirs = [ADD PATH TO FILES] → same path as code used in terminal, top level folder where files will be read from

Currently listed as: `top_level_dirs =/Volumes/Novel Database/Digitized Books/Sci-Fi Round 3`

### 7. Run ingestion code in terminal
Copy and paste the code (with path names added) into the terminal. Hit “Enter” and the ingestion script will run, packaging the following files into a .zip using the NOID as the file name:
* Image files (TIFF) for each page of each title (duplicated from server)
* OCR files for each page of each title (generated by Google Tesseract)
* Metadata file (YML) containing administrative and technical metadata
* Checksum file listing every file in package and its corresponding md5 hash value

### Troubleshooting
Check which version of Tesseract is installed on your machine before running OCR using the command `tesseract --version`. The most recent version is 5.2.0. It can be installed using the command ` brew install tesseract`. 

The following errors may occur when running the script above; if so, type the corresponding commands into the terminal to install needed packages: 

* No module named yaml → `pip3 install pyyaml` 
* No module named exifltool → `pip3 install pyexiftool` 
* No module named PIL → `pip3 install pillow`
* No module named pytesseract → `pip3 install pytesseract` 

